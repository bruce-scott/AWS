# Part 3
# create MySQL DB Instance on RDS
# log into AWS RDS Console
# create database with standard creation method
    # engine option: MySQL
    # version: 8.0.19 (latest)
    # template:free tier
    # db instance identifier: call-mysql-db-server
    # master username: admin
    # master password: Clarusway_1
    # db instance size: db.t2.micro
    # storage type:ssd
    # storage size:default 20GiB 
    # storage autoscaling: disabled
    # vpc:default
    # subnet group: default
    # publicly accessible: yes
    # security group: existing (allowing ssh and sql)
    # az: default no preference
    # db port: 3306
    # db authentication: password
    # ---- additional configuration -----
    # initial db name: clarusway
    # db parameter group & option group:default
    # automatic backups:enabled
    # backup retention period: 7 days
    # select window for backup to show snapshots
    # Enable auto minor version upgrade: enabled
    # deletion protection: enabled
# show configuration details of creating db for production
# show and explain newly created db instance description details


# Part 4
# launch EC2 Instance (Ubuntu 18.04) and name it as "MariaDB-Client on Ubuntu"
# update instance
sudo apt update -y
# install the mariadb-client
# connect the RDS MySQL DB instance with admin user, and paste the password when prompted
# show default databases in the MySQL server
# choose a database ('mysql' db) to work with. 
# show tables within the mysql db
# show users defined in the db server currently.
# create new database named "clarusway";
# show newly created database
# create a user named "hr_guy"; 
# grant permissions to the user "hr_guy" for database "clarusway" 
# you can not use grant all command on RDS DB Instance due to the restriction, following command will give an error.
# GRANT ALL ON clarusway.* TO hr_guy IDENTIFIED BY 'Hr_guy1234' WITH GRANT OPTION;
# ERROR 1064 (42000): You have an error in your SQL syntax; check the manual that corresponds to your MySQL server verersion for the right syntax to use near 'IDENTIFIED BY 'Hr_guy1234' WITH GRANT OPTION' at line 1 
# to grant permissions, you need to specify each permission explicitly
# update privileges
# close the mysql terminal
# download rds-ca-2019-root.pem from https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/UsingWithRDS.SSL.html
# login back to the RDS MySQL DB instance as "hr_guy" using the password defined with SSL
# show databases for hr_guy
# select the database clarusway
# create a table named "offices" 
# insert some data into the table named "offices"
# create a table named "employees" 
# insert some data into the table named "employees"
# show newly created tables;
# list all records within employees table
# list all records within offices table
# close the mysql terminal

=============================================================================
https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/UsingWithRDS.SSL.html
=============================================================================

CREATE TABLE `offices` (
  `office_id` int(11) NOT NULL,
  `address` varchar(50) NOT NULL,
  `city` varchar(50) NOT NULL,
  `state` varchar(50) NOT NULL,
  PRIMARY KEY (`office_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;


INSERT INTO `offices` VALUES (1,'03 Reinke Trail','Cincinnati','OH');
INSERT INTO `offices` VALUES (2,'5507 Becker Terrace','New York City','NY');
INSERT INTO `offices` VALUES (3,'54 Northland Court','Richmond','VA');
INSERT INTO `offices` VALUES (4,'08 South Crossing','Cincinnati','OH');
INSERT INTO `offices` VALUES (5,'553 Maple Drive','Minneapolis','MN');
INSERT INTO `offices` VALUES (6,'23 North Plaza','Aurora','CO');
INSERT INTO `offices` VALUES (7,'9658 Wayridge Court','Boise','ID');
INSERT INTO `offices` VALUES (8,'9 Grayhawk Trail','New York City','NY');
INSERT INTO `offices` VALUES (9,'16862 Westend Hill','Knoxville','TN');
INSERT INTO `offices` VALUES (10,'4 Bluestem Parkway','Savannah','GA');


CREATE TABLE `employees` (
  `employee_id` int(11) NOT NULL,
  `first_name` varchar(50) NOT NULL,
  `last_name` varchar(50) NOT NULL,
  `job_title` varchar(50) NOT NULL,
  `salary` int(11) NOT NULL,
  `reports_to` int(11) DEFAULT NULL,
  `office_id` int(11) NOT NULL,
  PRIMARY KEY (`employee_id`),
  KEY `fk_employees_offices_idx` (`office_id`),
  CONSTRAINT `fk_employees_offices` FOREIGN KEY (`office_id`) REFERENCES `offices` (`office_id`) ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;


INSERT INTO `employees` VALUES (37270,'Yovonnda','Magrannell','Executive Secretary',63996,NULL,10);
INSERT INTO `employees` VALUES (33391,'Darcy','Nortunen','Account Executive',62871,37270,1);
INSERT INTO `employees` VALUES (37851,'Sayer','Matterson','Statistician III',98926,37270,1);
INSERT INTO `employees` VALUES (40448,'Mindy','Crissil','Staff Scientist',94860,37270,1);
INSERT INTO `employees` VALUES (56274,'Keriann','Alloisi','VP Marketing',110150,37270,1);
INSERT INTO `employees` VALUES (63196,'Alaster','Scutchin','Assistant Professor',32179,37270,2);
INSERT INTO `employees` VALUES (67009,'North','de Clerc','VP Product Management',114257,37270,2);
INSERT INTO `employees` VALUES (67370,'Elladine','Rising','Social Worker',96767,37270,2);
INSERT INTO `employees` VALUES (68249,'Nisse','Voysey','Financial Advisor',52832,37270,2);
INSERT INTO `employees` VALUES (72540,'Guthrey','Iacopetti','Office Assistant I',117690,37270,3);
INSERT INTO `employees` VALUES (72913,'Kass','Hefferan','Computer Systems Analyst IV',96401,37270,3);
INSERT INTO `employees` VALUES (75900,'Virge','Goodrum','Information Systems Manager',54578,37270,3);
INSERT INTO `employees` VALUES (76196,'Mirilla','Janowski','Cost Accountant',119241,37270,3);
INSERT INTO `employees` VALUES (80529,'Lynde','Aronson','Junior Executive',77182,37270,4);
INSERT INTO `employees` VALUES (80679,'Mildrid','Sokale','Geologist II',67987,37270,4);
INSERT INTO `employees` VALUES (84791,'Hazel','Tarbert','General Manager',93760,37270,4);
INSERT INTO `employees` VALUES (95213,'Cole','Kesterton','Pharmacist',86119,37270,4);
INSERT INTO `employees` VALUES (96513,'Theresa','Binney','Food Chemist',47354,37270,5);
INSERT INTO `employees` VALUES (98374,'Estrellita','Daleman','Staff Accountant IV',70187,37270,5);
INSERT INTO `employees` VALUES (115357,'Ivy','Fearey','Structural Engineer',92710,37270,5);













# 06-12-2020
# AWS Lab Session - Callahan
# Relational Database Service (RDS)
# Session starts at 5.30pm EST
# Part 3
# create MySQL DB Instance on RDS
# log into AWS RDS Console
# create database with standard creation method
    # engine option: MySQL
    # version: 8.0.19 (latest)
    # template:free tier
    # db instance identifier: call-mysql-db-server
    # master username: admin
    # master password: Clarusway_1
    # db instance size: db.t2.micro
    # storage type:ssd
    # storage size:default 20GiB 
    # storage autoscaling: disabled
    # vpc:default
    # subnet group: default
    # publicly accessible: yes
    # security group: existing (allowing ssh and sql)
    # az: default no preference
    # db port: 3306
    # db authentication: password
    # ---- additional configuration -----
    # initial db name: clarusway
    # db parameter group & option group:default
    # automatic backups:enabled
    # backup retention period: 7 days
    # select window for backup to show snapshots
    10.15pm UTC -> 6.15pm EST, DUR: 30mins 
    # Enable auto minor version upgrade: enabled
    # deletion protection: enabled
# show configuration details of creating db for production
# show and explain newly created db instance description details
# Part 4
# launch EC2 Instance (Ubuntu 18.04) and name it as "MariaDB-Client on Ubuntu"
# update instance
sudo apt update -y
# install the mariadb-client
sudo apt-get install mariadb-client -y
# connect the RDS MySQL DB instance with admin user, and paste the password when prompted
mysql -h call-mysql-db-server.cbanmzptkrzf.us-east-1.rds.amazonawsst-1.rds.amazonaws.com -u admin -p
# show default databases in the MySQL server
SHOW DATABASES;
# choose a database ('mysql' db) to work with. 
USE mysql;
# show tables within the mysql db
SHOW TABLES;
# show users defined in the db server currently.
SELECT Host, User, authentication_string FROM user;
# create a user named "hr_guy"; 
CREATE USER hr_guy IDENTIFIED BY 'Hr_guy1234';
# grant permissions to the user "hr_guy" for database "clarusway" 
# you can not use grant all command on RDS DB Instance due to the restriction, following command will give an error.
GRANT ALL ON clarusway.* TO hr_guy IDENTIFIED BY 'Hr_guy1234' WITH GRANT OPTION;
# ERROR 1064 (42000): You have an error in your SQL syntax; check the manual that corresponds to your MySQL server verersion for the right syntax to use near 'IDENTIFIED BY 'Hr_guy1234' WITH GRANT OPTION' at line 1 
# to grant permissions, you need to specify each permission explicitly
GRANT SELECT, INSERT, UPDATE, DELETE, EXECUTE, REFERENCES, LOCK TABLES, ALTER, CREATE, CREATE TEMPORARY TABLES, DROP, INDEX, EVENT, CREATE VIEW, SHOW VIEW, CREATE ROUTINE, ALTER ROUTINE, TRIGGER ON clarusway.* TO hr_guy WITH GRANT OPTION;
# update privileges
FLUSH PRIVILEGES;
# close the mysql terminal
EXIT;
# download rds-ca-2019-root.pem from https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/UsingWithRDS.SSL.html
wget https://s3.amazonaws.com/rds-downloads/rds-ca-2019-root.pem
# login back to the RDS MySQL DB instance as "hr_guy" using the password defined with SSL
mysql -h call-mysql-db-server.cbanmzptkrzf.us-east-1.rds.amazonaws.com --ssl-ca=rds-ca-2019-root.pem -u hr_guy -p clarusway 
# create a table named "offices" 
CREATE TABLE `offices` (
  `office_id` int(11) NOT NULL,
  `address` varchar(50) NOT NULL,
  `city` varchar(50) NOT NULL,
  `state` varchar(50) NOT NULL,
  PRIMARY KEY (`office_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
# insert some data into the table named "offices"
INSERT INTO `offices` VALUES (1,'03 Reinke Trail','Cincinnati','OH');
INSERT INTO `offices` VALUES (2,'5507 Becker Terrace','New York City','NY');
INSERT INTO `offices` VALUES (3,'54 Northland Court','Richmond','VA');
INSERT INTO `offices` VALUES (4,'08 South Crossing','Cincinnati','OH');
INSERT INTO `offices` VALUES (5,'553 Maple Drive','Minneapolis','MN');
INSERT INTO `offices` VALUES (6,'23 North Plaza','Aurora','CO');
INSERT INTO `offices` VALUES (7,'9658 Wayridge Court','Boise','ID');
INSERT INTO `offices` VALUES (8,'9 Grayhawk Trail','New York City','NY');
INSERT INTO `offices` VALUES (9,'16862 Westend Hill','Knoxville','TN');
INSERT INTO `offices` VALUES (10,'4 Bluestem Parkway','Savannah','GA');
# create a table named "employees" 
CREATE TABLE `employees` (
  `employee_id` int(11) NOT NULL,
  `first_name` varchar(50) NOT NULL,
  `last_name` varchar(50) NOT NULL,
  `job_title` varchar(50) NOT NULL,
  `salary` int(11) NOT NULL,
  `reports_to` int(11) DEFAULT NULL,
  `office_id` int(11) NOT NULL,
  PRIMARY KEY (`employee_id`),
  KEY `fk_employees_offices_idx` (`office_id`),
  CONSTRAINT `fk_employees_offices` FOREIGN KEY (`office_id`) REFERENCES `offices` (`office_id`) ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
# insert some data into the table named "employees"
INSERT INTO `employees` VALUES (37270,'Yovonnda','Magrannell','Executive Secretary',63996,NULL,10);
INSERT INTO `employees` VALUES (33391,'Darcy','Nortunen','Account Executive',62871,37270,1);
INSERT INTO `employees` VALUES (37851,'Sayer','Matterson','Statistician III',98926,37270,1);
INSERT INTO `employees` VALUES (40448,'Mindy','Crissil','Staff Scientist',94860,37270,1);
INSERT INTO `employees` VALUES (56274,'Keriann','Alloisi','VP Marketing',110150,37270,1);
INSERT INTO `employees` VALUES (63196,'Alaster','Scutchin','Assistant Professor',32179,37270,2);
INSERT INTO `employees` VALUES (67009,'North','de Clerc','VP Product Management',114257,37270,2);
INSERT INTO `employees` VALUES (67370,'Elladine','Rising','Social Worker',96767,37270,2);
INSERT INTO `employees` VALUES (68249,'Nisse','Voysey','Financial Advisor',52832,37270,2);
INSERT INTO `employees` VALUES (72540,'Guthrey','Iacopetti','Office Assistant I',117690,37270,3);
INSERT INTO `employees` VALUES (72913,'Kass','Hefferan','Computer Systems Analyst IV',96401,37270,3);
INSERT INTO `employees` VALUES (75900,'Virge','Goodrum','Information Systems Manager',54578,37270,3);
INSERT INTO `employees` VALUES (76196,'Mirilla','Janowski','Cost Accountant',119241,37270,3);
INSERT INTO `employees` VALUES (80529,'Lynde','Aronson','Junior Executive',77182,37270,4);
INSERT INTO `employees` VALUES (80679,'Mildrid','Sokale','Geologist II',67987,37270,4);
INSERT INTO `employees` VALUES (84791,'Hazel','Tarbert','General Manager',93760,37270,4);
INSERT INTO `employees` VALUES (95213,'Cole','Kesterton','Pharmacist',86119,37270,4);
INSERT INTO `employees` VALUES (96513,'Theresa','Binney','Food Chemist',47354,37270,5);
INSERT INTO `employees` VALUES (98374,'Estrellita','Daleman','Staff Accountant IV',70187,37270,5);
INSERT INTO `employees` VALUES (115357,'Ivy','Fearey','Structural Engineer',92710,37270,5);
# show newly created tables;
SHOW TABLES;
# list all records within employees table
SELECT * FROM offices;
# list all records within offices table
SELECT * FROM employees;
# close the mysql terminal
EXIT;
